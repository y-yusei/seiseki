{% extends 'school_management/base.html' %}

{% block title %}学生一括追加 - {{ classroom.class_name }}{% endblock %}
{% block page_title %}学生一括追加{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8">
        <div class="card mt-3">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5><i class="fas fa-user-plus me-2"></i>学生一括追加</h5>
                <div>
                    <a href="{% url 'school_management:class_detail' classroom.id %}" class="btn btn-outline-secondary btn-sm">
                        <i class="fas fa-arrow-left me-1"></i>戻る
                    </a>
                </div>
            </div>
            <div class="card-body">
                <div class="mb-3 p-3 bg-light rounded">
                    <h6 class="text-primary mb-2"><i class="fas fa-info-circle me-2"></i>対象クラス</h6>
                    <strong>{{ classroom.class_name }}</strong> - {{ classroom.year }}年度 {{ classroom.get_semester_display }}
                </div>

                <form method="post">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label for="student_data" class="form-label">
                            <i class="fas fa-file-upload me-2"></i>学生データ
                        </label>
                        <textarea class="form-control" id="student_data" name="student_data" rows="15" 
                                  placeholder="学生番号,氏名,メールアドレス&#10;例:&#10;2024001,山田太郎,yamada@example.com&#10;2024002,佐藤花子,sato@example.com&#10;2024003,田中次郎,tanaka@example.com" 
                                  required></textarea>
                        <div class="form-text">
                            <strong>入力形式:</strong> 学生番号,氏名,メールアドレス (1行に1人)<br>
                            <strong>区切り文字:</strong> カンマ(,) またはタブ<br>
                            <strong>必須項目:</strong> 学生番号、氏名 (メールアドレスは省略可能)<br>
                            <strong>デフォルトパスワード:</strong> student123
                        </div>
                    </div>

                    <div class="d-flex justify-content-between">
                        <a href="{% url 'school_management:class_detail' classroom.id %}" class="btn btn-secondary">
                            <i class="fas fa-arrow-left me-1"></i>キャンセル
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-user-plus me-1"></i>学生を追加
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-lg-4">
        <div class="card mt-3">
            <div class="card-header">
                <h6><i class="fas fa-lightbulb me-2"></i>入力例</h6>
            </div>
            <div class="card-body">
                <code class="d-block mb-2">2024001,山田太郎,yamada@example.com,ヤマダタロウ</code>
                <code class="d-block mb-2">2024002,佐藤花子,sato@example.com,サトウハナコ</code>
                <code class="d-block mb-2">2024003,田中次郎</code>
                <small class="text-muted">メールアドレスとフリガナを省略した場合、デフォルト値が設定されます。</small>
            </div>
        </div>
        
        <div class="card mt-3">
            <div class="card-header">
                <h6><i class="fas fa-file-excel me-2"></i>Excelからの貼り付け</h6>
            </div>
            <div class="card-body">
                <p class="small mb-2">Excelやスプレッドシートから直接コピー＆ペーストできます。</p>
                <ol class="small">
                    <li>Excel等で学生データを選択</li>
                    <li>Ctrl+Cでコピー</li>
                    <li>テキストエリアにCtrl+Vで貼り付け</li>
                </ol>
            </div>
        </div>

        <div class="card mt-3">
            <div class="card-header">
                <h6><i class="fas fa-exclamation-triangle me-2"></i>注意事項</h6>
            </div>
            <div class="card-body">
                <ul class="small mb-0">
                    <li>学生番号は重複できません</li>
                    <li>既存の学生番号がある場合はスキップされます</li>
                    <li>エラーがある行は処理されません</li>
                    <li>空行は自動的に無視されます</li>
                </ul>
            </div>
        </div>

        <div class="card mt-3">
            <div class="card-header">
                <h6><i class="fas fa-download me-2"></i>テンプレート</h6>
            </div>
            <div class="card-body">
                <button type="button" class="btn btn-outline-primary btn-sm w-100" onclick="insertTemplate()">
                    <i class="fas fa-file-download me-1"></i>サンプルデータを挿入
                </button>
            </div>
        </div>
    </div>
</div>

<script>
function insertTemplate() {
    const textarea = document.getElementById('student_data');
    const template = `2024001,山田太郎,yamada@example.com,ヤマダタロウ
2024002,佐藤花子,sato@example.com,サトウハナコ
2024003,田中次郎,tanaka@example.com,タナカジロウ
2024004,鈴木一郎,suzuki@example.com,スズキイチロウ
2024005,高橋美香,takahashi@example.com,タカハシミカ`;
    
    textarea.value = template;
    textarea.focus();
}

// 貼り付け時の自動フォーマット
document.getElementById('student_data').addEventListener('paste', function(e) {
    setTimeout(() => {
        // タブをカンマに変換
        this.value = this.value.replace(/\t/g, ',');
    }, 100);
});
</script>
{% endblock %}
