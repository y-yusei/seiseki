{% extends 'school_management/base.html' %}

{% block title %}QR„Ç≥„Éº„Éâ„Çπ„Ç≠„É£„É≥{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title mb-0">
                        <i class="fas fa-camera me-2"></i>QR„Ç≥„Éº„Éâ„Çπ„Ç≠„É£„É≥
                    </h2>
                </div>
                <div class="card-body text-center">
                    {% if qr_code %}
                        <div class="alert alert-success">
                            <i class="fas fa-check-circle fa-2x mb-3"></i>
                            <h4>üéâ „Çπ„Ç≠„É£„É≥ÊàêÂäüÔºÅ</h4>
                            <p class="mb-2">{{ qr_code.student.full_name }}„Åï„Çì„ÅÆQR„Ç≥„Éº„Éâ„Çí„Çπ„Ç≠„É£„É≥„Åó„Åæ„Åó„Åü„ÄÇ</p>
                            {% if classroom %}
                                <p class="mb-2">
                                    <strong class="text-primary">
                                        <i class="fas fa-chalkboard me-1"></i>
                                        „ÇØ„É©„Çπ: {{ classroom.class_name }}
                                    </strong>
                                </p>
                            {% endif %}
                            {% if points_added %}
                                <p class="mb-2">
                                    <strong class="text-success">
                                        <i class="fas fa-star me-1"></i>
                                        {{ qr_code.student.full_name }}„Åï„Çì„ÅÆ„ÇØ„É©„Çπ„Éù„Ç§„É≥„Éà„Åå <span class="badge bg-success fs-6">+1</span> Â¢óÂä†„Åó„Åæ„Åó„ÅüÔºÅ
                                    </strong>
                                </p>
                                {% if student_class_points is not None %}
                                    <p class="mb-0">
                                        <strong>ÁèæÂú®„ÅÆ„ÇØ„É©„Çπ„Éù„Ç§„É≥„Éà:</strong> 
                                        <span class="badge bg-primary fs-6">{{ student_class_points }}pt</span>
                                    </p>
                                {% endif %}
                            {% else %}
                                <div class="alert alert-warning mt-2">
                                    <i class="fas fa-exclamation-triangle me-2"></i>
                                    „ÇØ„É©„Çπ„ÅåÊåáÂÆö„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑ„Åü„ÇÅ„ÄÅ„Éù„Ç§„É≥„Éà„ÅØ‰ªò‰∏é„Åï„Çå„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ
                                </div>
                            {% endif %}
                            <p class="mt-2 mb-0">
                                <small class="text-muted">
                                    <i class="fas fa-user-tie me-1"></i>
                                    ÂÖàÁîü„Å®„Åó„Å¶„Éù„Ç§„É≥„Éà„Çí‰ªò‰∏é„Åó„Åæ„Åó„Åü
                                </small>
                            </p>
                        </div>
                        
                        <div class="row mt-4">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title">„Çπ„Ç≠„É£„É≥ÊÉÖÂ†±</h5>
                                        <p class="mb-1"><strong>QR„Ç≥„Éº„ÉâÊâÄÊúâËÄÖ:</strong> {{ qr_code.student.full_name }}</p>
                                        <p class="mb-1"><strong>Â≠¶Á±çÁï™Âè∑:</strong> {{ qr_code.student.student_number }}</p>
                                        {% if classroom %}
                                            <p class="mb-1"><strong>„ÇØ„É©„Çπ:</strong> {{ classroom.class_name }}</p>
                                        {% endif %}
                                        <p class="mb-1">
                                            <strong>‰ªò‰∏é„Éù„Ç§„É≥„Éà:</strong> 
                                            {% if points_added %}
                                                <span class="badge bg-success fs-6">+1ÁÇπ</span>
                                            {% else %}
                                                <span class="badge bg-secondary fs-6">0ÁÇπ</span>
                                            {% endif %}
                                        </p>
                                        <p class="mb-0"><strong>„Çπ„Ç≠„É£„É≥Êó•ÊôÇ:</strong> {{ scan_time }}</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                                                    <div class="card">
                                        <div class="card-body">
                                            <h5 class="card-title">ÂÖàÁîü„ÅÆÊÉÖÂ†±</h5>
                                            <p class="mb-1"><strong>ÂêçÂâç:</strong> {{ request.user.full_name }}</p>
                                            <p class="mb-1"><strong>ÊïôÂì°ID:</strong> {{ request.user.teacher_id|default:"-" }}</p>
                                            <p class="mb-1"><strong>ÂΩπÂâ≤:</strong> {{ request.user.get_role_display }}</p>
                                            <p class="mb-0"><strong>„Çπ„Ç≠„É£„É≥„Åó„ÅüÂõûÊï∞:</strong> {{ user_scan_count }}Âõû</p>
                                        </div>
                                    </div>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            {% if classroom %}
                                <a href="{% url 'school_management:class_detail' classroom.id %}" class="btn btn-primary me-2">
                                    <i class="fas fa-arrow-left me-1"></i>{{ classroom.class_name }}„ÅÆË©≥Á¥∞„Å´Êàª„Çã
                                </a>
                                <a href="{% url 'school_management:class_qr_codes' classroom.id %}" class="btn btn-outline-primary">
                                    <i class="fas fa-qrcode me-1"></i>„ÇØ„É©„ÇπQR„Ç≥„Éº„Éâ‰∏ÄË¶ß
                                </a>
                            {% else %}
                                <a href="{% url 'school_management:qr_code_list' %}" class="btn btn-primary me-2">
                                    <i class="fas fa-home me-1"></i>QR„Ç≥„Éº„Éâ‰∏ÄË¶ß„Å´Êàª„Çã
                                </a>
                                {% if qr_code.student.classroom_set.first %}
                                    <a href="{% url 'school_management:class_qr_codes' qr_code.student.classroom_set.first.id %}" class="btn btn-outline-primary">
                                        <i class="fas fa-chalkboard me-1"></i>„ÇØ„É©„ÇπQR„Ç≥„Éº„Éâ
                                    </a>
                                {% endif %}
                            {% endif %}
                        </div>
                    {% else %}
                        <div class="alert alert-danger">
                            <i class="fas fa-exclamation-triangle fa-2x mb-3"></i>
                            <h4>„Çπ„Ç≠„É£„É≥„Ç®„É©„Éº</h4>
                            <p class="mb-0">{{ error_message }}</p>
                        </div>
                        
                        <div class="mt-4">
                            <a href="{% url 'school_management:student_dashboard' %}" class="btn btn-primary">
                                <i class="fas fa-home me-1"></i>„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„Å´Êàª„Çã
                            </a>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
